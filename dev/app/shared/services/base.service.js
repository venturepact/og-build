"use strict";
var http_1 = require('@angular/http');
var Observable_1 = require('rxjs/Observable');
require('rxjs/add/observable/throw');
var env_config_1 = require('./../../config/env.config');
var BaseService = (function () {
    function BaseService() {
        this._url = env_config_1.Config.API;
        this.storage = this.readCookie('storage');
        if (this.storage) {
            this.storage = JSON.parse(this.storage);
            this.headers = new http_1.Headers({ 'Content-Type': 'application/json', 'Authorization': 'JWT ' + this.storage.token });
        }
        else {
            this.headers = new http_1.Headers({ 'Content-Type': 'application/json' });
        }
        this.options = new http_1.RequestOptions({ headers: this.headers });
    }
    BaseService.prototype.post_options = function () {
        return new http_1.RequestOptions({ headers: this.headers, method: 'post' });
    };
    BaseService.prototype.get_options = function () {
        this.storage = this.readCookie('storage');
        if (this.storage) {
            this.storage = JSON.parse(this.storage);
            this.headers = new http_1.Headers({ 'Content-Type': 'application/json', 'Authorization': 'JWT ' + this.storage.token });
        }
        return new http_1.RequestOptions({ headers: this.headers });
    };
    BaseService.prototype.put_options = function () {
        this.storage = this.readCookie('storage');
        if (this.storage) {
            this.storage = JSON.parse(this.storage);
            this.headers = new http_1.Headers({ 'Content-Type': 'application/json', 'Authorization': 'JWT ' + this.storage.token });
        }
        return new http_1.RequestOptions({ headers: this.headers, method: 'put' });
    };
    BaseService.prototype.patch_options = function () {
        return new http_1.RequestOptions({ headers: this.headers, method: 'patch' });
    };
    BaseService.prototype.extractData = function (res) {
        var body = res.json();
        return body.data || {};
    };
    BaseService.prototype.boolData = function (res) {
        var body = res.json();
        return body.data;
    };
    BaseService.prototype.handleError = function (error) {
        var body = error.json();
        if (body.error.code === 'TokenExpiredError') {
            var expires = "";
            var domain = env_config_1.Config.APP_EXTENSION;
            var days = -1;
            var value = '';
            if (days) {
                var date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = "storage=" + value + expires + "; domain=" + domain + "; path=/";
            window.location.href = env_config_1.Config.APP_DOMAIN;
        }
        return Observable_1.Observable.throw(body);
    };
    BaseService.prototype.readCookie = function (name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ')
                c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) == 0)
                return c.substring(nameEQ.length, c.length);
        }
        return null;
    };
    BaseService.prototype.createCookie = function (name, value, days) {
        var expires = "";
        var domain = env_config_1.Config.APP_EXTENSION;
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + value + expires + "; domain=" + domain + "; path=/";
    };
    BaseService.prototype.eraseCookie = function (name) {
        this.createCookie(name, "", -1);
    };
    return BaseService;
}());
exports.BaseService = BaseService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9zaGFyZWQvc2VydmljZXMvYmFzZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxxQkFBa0QsZUFBZSxDQUFDLENBQUE7QUFDbEUsMkJBQTJCLGlCQUFpQixDQUFDLENBQUE7QUFDN0MsUUFBTywyQkFBMkIsQ0FBQyxDQUFBO0FBQ25DLDJCQUF1QiwyQkFBMkIsQ0FBQyxDQUFBO0FBRW5EO0lBT0U7UUFKVSxTQUFJLEdBQUcsbUJBQU0sQ0FBQyxHQUFHLENBQUM7UUFNMUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ2pCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDeEMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLGNBQU8sQ0FBQyxFQUFFLGNBQWMsRUFBRSxrQkFBa0IsRUFBRSxlQUFlLEVBQUUsTUFBTSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUNuSCxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksY0FBTyxDQUFDLEVBQUUsY0FBYyxFQUFFLGtCQUFrQixFQUFFLENBQUMsQ0FBQztRQUNyRSxDQUFDO1FBQ0QsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLHFCQUFjLENBQUMsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7SUFFL0QsQ0FBQztJQUVTLGtDQUFZLEdBQXRCO1FBQ0UsTUFBTSxDQUFDLElBQUkscUJBQWMsQ0FBQyxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7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TSxDQUFDLGFBQWEsQ0FBQztRQUNuQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ1AsSUFBSSxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUN0QixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBQyxDQUFDLElBQUksR0FBQyxFQUFFLEdBQUMsRUFBRSxHQUFDLEVBQUUsR0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ2xELE9BQU8sR0FBRyxZQUFZLEdBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQzlDLENBQUM7UUFDRCxRQUFRLENBQUMsTUFBTSxHQUFHLElBQUksR0FBQyxHQUFHLEdBQUMsS0FBSyxHQUFDLE9BQU8sR0FBQyxXQUFXLEdBQUMsTUFBTSxHQUFDLFVBQVUsQ0FBQztJQUM3RSxDQUFDO0lBRUQsaUNBQVcsR0FBWCxVQUFZLElBQVc7UUFDbkIsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUMsRUFBRSxFQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbEMsQ0FBQztJQUNILGtCQUFDO0FBQUQsQ0FuR0EsQUFtR0MsSUFBQTtBQW5HWSxtQkFBVyxjQW1HdkIsQ0FBQSIsImZpbGUiOiJhcHAvc2hhcmVkL3NlcnZpY2VzL2Jhc2Uuc2VydmljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlc3BvbnNlLCBIZWFkZXJzLCBSZXF1ZXN0T3B0aW9ucyB9IGZyb20gJ0Bhbmd1bGFyL2h0dHAnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcy9PYnNlcnZhYmxlJztcclxuaW1wb3J0ICdyeGpzL2FkZC9vYnNlcnZhYmxlL3Rocm93JztcclxuaW1wb3J0IHsgQ29uZmlnIH0gZnJvbSAnLi8uLi8uLi9jb25maWcvZW52LmNvbmZpZyc7XHJcblxyXG5leHBvcnQgY2xhc3MgQmFzZVNlcnZpY2Uge1xyXG5cclxuICBzdG9yYWdlOiBhbnk7XHJcbiAgcHJvdGVjdGVkIF91cmwgPSBDb25maWcuQVBJO1xyXG4gIHByb3RlY3RlZCBoZWFkZXJzOiBhbnk7XHJcbiAgcHJvdGVjdGVkIG9wdGlvbnM6IGFueTtcclxuICAvLyBwcml2YXRlIGxvZ2dlZE91dFNlcnZpY2UgOiBMb2dnZWRPdXRTZXJ2aWNlID0gbmV3IExvZ2dlZE91dFNlcnZpY2UoKTtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIC8vIGNvbnNvbGUubG9nKENvbmZpZyk7XHJcbiAgICB0aGlzLnN0b3JhZ2UgPSB0aGlzLnJlYWRDb29raWUoJ3N0b3JhZ2UnKTtcclxuICAgIGlmICh0aGlzLnN0b3JhZ2UpIHtcclxuICAgICAgdGhpcy5zdG9yYWdlID0gSlNPTi5wYXJzZSh0aGlzLnN0b3JhZ2UpO1xyXG4gICAgICB0aGlzLmhlYWRlcnMgPSBuZXcgSGVhZGVycyh7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsICdBdXRob3JpemF0aW9uJzogJ0pXVCAnICsgdGhpcy5zdG9yYWdlLnRva2VuIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5oZWFkZXJzID0gbmV3IEhlYWRlcnMoeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0pO1xyXG4gICAgfVxyXG4gICAgdGhpcy5vcHRpb25zID0gbmV3IFJlcXVlc3RPcHRpb25zKHsgaGVhZGVyczogdGhpcy5oZWFkZXJzIH0pO1xyXG4gICAgLy9jb25zb2xlLmxvZyh0aGlzLm9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIHBvc3Rfb3B0aW9ucygpIHtcclxuICAgIHJldHVybiBuZXcgUmVxdWVzdE9wdGlvbnMoeyBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsIG1ldGhvZDogJ3Bvc3QnIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGdldF9vcHRpb25zKCl7XHJcbiAgICB0aGlzLnN0b3JhZ2UgPSB0aGlzLnJlYWRDb29raWUoJ3N0b3JhZ2UnKTtcclxuICAgIGlmICh0aGlzLnN0b3JhZ2UpIHtcclxuICAgICAgdGhpcy5zdG9yYWdlID0gSlNPTi5wYXJzZSh0aGlzLnN0b3JhZ2UpO1xyXG4gICAgICB0aGlzLmhlYWRlcnMgPSBuZXcgSGVhZGVycyh7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsICdBdXRob3JpemF0aW9uJzogJ0pXVCAnICsgdGhpcy5zdG9yYWdlLnRva2VuIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5ldyBSZXF1ZXN0T3B0aW9ucyh7IGhlYWRlcnM6IHRoaXMuaGVhZGVyc30pO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIHB1dF9vcHRpb25zKCkge1xyXG4gICAgdGhpcy5zdG9yYWdlID0gdGhpcy5yZWFkQ29va2llKCdzdG9yYWdlJyk7XHJcbiAgICBpZiAodGhpcy5zdG9yYWdlKSB7XHJcbiAgICAgIHRoaXMuc3RvcmFnZSA9IEpTT04ucGFyc2UodGhpcy5zdG9yYWdlKTtcclxuICAgICAgdGhpcy5oZWFkZXJzID0gbmV3IEhlYWRlcnMoeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLCAnQXV0aG9yaXphdGlvbic6ICdKV1QgJyArIHRoaXMuc3RvcmFnZS50b2tlbiB9KTtcclxuICAgIH1cclxuICAgICAgIHJldHVybiBuZXcgUmVxdWVzdE9wdGlvbnMoeyBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsIG1ldGhvZDogJ3B1dCcgfSk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgcGF0Y2hfb3B0aW9ucygpIHtcclxuICAgIHJldHVybiBuZXcgUmVxdWVzdE9wdGlvbnMoeyBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsIG1ldGhvZDogJ3BhdGNoJyB9KTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBleHRyYWN0RGF0YShyZXM6IFJlc3BvbnNlKSB7XHJcbiAgICBsZXQgYm9keSA9IHJlcy5qc29uKCk7XHJcbiAgICByZXR1cm4gYm9keS5kYXRhIHx8IHt9O1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGJvb2xEYXRhKHJlczogUmVzcG9uc2UpIHtcclxuICAgIGxldCBib2R5ID0gcmVzLmpzb24oKTtcclxuICAgIHJldHVybiBib2R5LmRhdGE7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgaGFuZGxlRXJyb3IoZXJyb3I6IFJlc3BvbnNlKSB7XHJcbiAgICBsZXQgYm9keSA9IGVycm9yLmpzb24oKTtcclxuICAgIGlmIChib2R5LmVycm9yLmNvZGUgPT09ICdUb2tlbkV4cGlyZWRFcnJvcicpIHtcclxuICAgICAgbGV0IGV4cGlyZXMgPSBcIlwiO1xyXG4gICAgICBsZXQgZG9tYWluICA9IENvbmZpZy5BUFBfRVhURU5TSU9OO1xyXG4gICAgICBsZXQgZGF5cyA9IC0xO1xyXG4gICAgICBsZXQgdmFsdWUgPSAnJztcclxuICAgICAgaWYgKGRheXMpIHtcclxuICAgICAgICAgIGxldCBkYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgICAgIGRhdGUuc2V0VGltZShkYXRlLmdldFRpbWUoKSsoZGF5cyoyNCo2MCo2MCoxMDAwKSk7XHJcbiAgICAgICAgICBleHBpcmVzID0gXCI7IGV4cGlyZXM9XCIrZGF0ZS50b1VUQ1N0cmluZygpO1xyXG4gICAgICB9XHJcbiAgICAgIGRvY3VtZW50LmNvb2tpZSA9IFwic3RvcmFnZT1cIit2YWx1ZStleHBpcmVzK1wiOyBkb21haW49XCIrZG9tYWluK1wiOyBwYXRoPS9cIjtcclxuXHRcdFx0d2luZG93LmxvY2F0aW9uLmhyZWYgPSBDb25maWcuQVBQX0RPTUFJTjtcclxuICAgIH1cclxuICAgIHJldHVybiBPYnNlcnZhYmxlLnRocm93KGJvZHkpO1xyXG4gIH1cclxuICBcclxuICByZWFkQ29va2llKG5hbWU6c3RyaW5nKSB7XHJcbiAgICAgIGxldCBuYW1lRVEgPSBuYW1lICsgXCI9XCI7XHJcbiAgICAgIGxldCBjYSA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgnOycpO1xyXG4gICAgICBmb3IobGV0IGk9MDsgaSA8IGNhLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICBsZXQgYyA9IGNhW2ldO1xyXG4gICAgICAgICAgd2hpbGUgKGMuY2hhckF0KDApPT0nICcpIGMgPSBjLnN1YnN0cmluZygxLGMubGVuZ3RoKTtcclxuICAgICAgICAgIGlmIChjLmluZGV4T2YobmFtZUVRKSA9PSAwKSByZXR1cm4gYy5zdWJzdHJpbmcobmFtZUVRLmxlbmd0aCxjLmxlbmd0aCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICBjcmVhdGVDb29raWUobmFtZTpzdHJpbmcsdmFsdWU6c3RyaW5nLGRheXM6bnVtYmVyKSB7XHJcbiAgICAgICAgbGV0IGV4cGlyZXMgPSBcIlwiO1xyXG4gICAgICAgIGxldCBkb21haW4gID0gQ29uZmlnLkFQUF9FWFRFTlNJT047XHJcbiAgICAgICAgaWYgKGRheXMpIHtcclxuICAgICAgICAgICAgbGV0IGRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICBkYXRlLnNldFRpbWUoZGF0ZS5nZXRUaW1lKCkrKGRheXMqMjQqNjAqNjAqMTAwMCkpO1xyXG4gICAgICAgICAgICBleHBpcmVzID0gXCI7IGV4cGlyZXM9XCIrZGF0ZS50b1VUQ1N0cmluZygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBkb2N1bWVudC5jb29raWUgPSBuYW1lK1wiPVwiK3ZhbHVlK2V4cGlyZXMrXCI7IGRvbWFpbj1cIitkb21haW4rXCI7IHBhdGg9L1wiO1xyXG4gIH1cclxuXHJcbiAgZXJhc2VDb29raWUobmFtZTpzdHJpbmcpIHtcclxuICAgICAgdGhpcy5jcmVhdGVDb29raWUobmFtZSxcIlwiLC0xKTtcclxuICB9XHJcbn1cclxuXHJcbiJdfQ==
