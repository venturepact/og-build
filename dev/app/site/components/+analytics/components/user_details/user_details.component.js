"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require('@angular/core');
var date_range_picker_component_1 = require('../date_range_picker/date_range_picker.component');
var calculator_analytics_service_1 = require('../../services/calculator-analytics.service');
var user_details_popup_component_1 = require('../user_details_popup/user_details_popup.component');
var index_1 = require('../../../../../shared/services/index');
var router_1 = require('@angular/router');
var UserDetailsComponent = (function () {
    function UserDetailsComponent(_calculatorAnalytics, _featureAuthService) {
        this._calculatorAnalytics = _calculatorAnalytics;
        this._featureAuthService = _featureAuthService;
        this.dataSet = [];
        this.avgAnswered = 0;
        this.avgResult = 0;
        this.totalTime = 0;
        this.limit_alert = false;
        this.loader = 0;
        this.postData = {
            start_date: moment().subtract(10, 'days').format('YYYY-MM-DD'),
            end_date: moment().add(1, 'day').format('YYYY-MM-DD')
        };
        this.viewedOnStats = {
            desktop: 0,
            mobile: 0
        };
        this.viewedViaStats = {
            facebook: 0,
            twitter: 0,
            direct: 0
        };
        this.subs = [];
        this.leadLimit = this._featureAuthService.features.leads;
    }
    UserDetailsComponent.prototype.ngAfterViewInit = function () {
        var self = this;
        jQuery(document).on('click', 'a.paginate_button', function () {
            self.initializeViewDetails();
        });
    };
    UserDetailsComponent.prototype.ngOnInit = function () { };
    UserDetailsComponent.prototype.initializeViewDetails = function () {
        var _this = this;
        jQuery('.vd').unbind().bind('click', function (event) {
            _this.visitorKey = jQuery(event.target).data('key');
            jQuery('.user-detail-outer').toggle('slide', { direction: 'right' }, 700);
        });
    };
    UserDetailsComponent.prototype.ngOnChanges = function () {
        if (this.calc) {
            if (this.calc.liveApp)
                this.calc_id = this.calc._id;
            else
                this.calc_id = this.calc.parentApp;
            this.loader = 0;
            this.subs.push(this.getLeadData(this.calc_id));
        }
    };
    UserDetailsComponent.prototype.getLeadData = function (id) {
        var _this = this;
        return this._calculatorAnalytics.getLeads({ id: id, date: this.postData })
            .subscribe(function (response) {
            if (_this.leadLimit != -1) {
                _this.dataSet = response.data.splice(0, _this.leadLimit);
            }
            else
                _this.dataSet = response.data;
            _this.limit_alert = response.limit_cross;
            _this.avgAnswered = Math.round(response.avgAnswers);
            _this.avgResult = response.avgResult;
            _this.dataSet = _this.dataSet.map(function (data) {
                _this.subs.push(_this.getAnalyticData(data));
                data.shift();
                return data;
            });
            _this.intializeDatatable();
        }, function (error) {
            console.log(error);
        });
    };
    UserDetailsComponent.prototype.getAnalyticData = function (lead) {
        var _this = this;
        this.postData.type = 'leadStats';
        this.postData.calc_id = lead[0];
        return this._calculatorAnalytics.getTrafficStats(this.postData)
            .subscribe(function (response) {
            if (response.length) {
                lead[4] = (response[0][4] > 60) ? (response[0][4] / 60).toFixed(2) + ' m' : response[0][4] + ' s';
                lead[3] = response[0][3];
                lead[5] = (response[0][2] == '(not set)' ? 'direct' : response[0][2]);
                _this.totalTime += Number(response[0][4]);
                var avgTime = _this.totalTime / _this.dataSet.length;
                _this.avgLengthTime = (avgTime > 60) ? (avgTime / 60).toFixed(2) + ' m' : avgTime.toFixed(2) + ' s';
                _this.viewedOnStats[response[0][3]] += 1;
                _this.viewedViaStats[response[0][2] == '(not set)' ? 'direct' : response[0][2]] += 1;
                _this.mostViewedVia = Object.keys(_this.viewedViaStats).reduce(function (a, b) { return _this.viewedViaStats[a] > _this.viewedViaStats[b] ? a : b; });
                _this.mostViewedOn = Object.keys(_this.viewedOnStats).reduce(function (a, b) { return _this.viewedOnStats[a] > _this.viewedOnStats[b] ? a : b; });
                _this.intializeDatatable();
            }
            else {
                lead[3] = lead[4] = lead[5] = 'Not Available';
                _this.intializeDatatable();
            }
        }, function (error) {
        });
    };
    UserDetailsComponent.prototype.intializeDatatable = function () {
        var _this = this;
        var self = this;
        if (this.dataTableRef === undefined) {
            this.dataTableRef = jQuery('#myTable').DataTable({
                data: this.dataSet,
                'sPaginationType': 'full_numbers',
                language: {
                    emptyTable: '<center>No data available</center>',
                    paginate: {
                        "previous": '<i class="material-icons">skip_previous</i>',
                        "first": '<i class="material-icons">keyboard_arrow_left</i>',
                        "next": '<i class="material-icons">skip_next</i>',
                        "last": '<i class="material-icons">keyboard_arrow_right</i>'
                    }
                },
                columns: [
                    { title: 'Name' },
                    { title: 'Questions Answered' },
                    { title: (self.calc.templateType == 'Numerical') ? 'Result Obtained' : 'Outcome Obtained' },
                    { title: 'Visited On' },
                    { title: 'Length of Visit' },
                    { title: 'Visited Via' },
                    { title: 'View Details' }
                ]
            });
        }
        else {
            this.dataTableRef.clear();
            this.dataTableRef.rows.add(this.dataSet);
            this.dataTableRef.draw();
        }
        jQuery('.vd').unbind().bind('click', function (event) {
            _this.visitorKey = jQuery(event.target).data('key');
            jQuery('.user-detail-outer').toggle('slide', { direction: 'right' }, 700);
        });
        this.loader = 1;
    };
    UserDetailsComponent.prototype.onDateSelect = function (date) {
        this.postData.start_date = date.start_date;
        this.postData.end_date = date.end_date;
        if (this.calc_id) {
            this.subs.push(this.getLeadData(this.calc_id));
        }
    };
    UserDetailsComponent.prototype.ngOnDestroy = function () {
        this.unsubscribe();
    };
    UserDetailsComponent.prototype.unsubscribe = function () {
        this.subs.forEach(function (sub) { return sub.unsubscribe(); });
    };
    __decorate([
        core_1.Input(), 
        __metadata('design:type', Object)
    ], UserDetailsComponent.prototype, "calc", void 0);
    UserDetailsComponent = __decorate([
        core_1.Component({
            moduleId: module.id,
            selector: 'og-user-details',
            templateUrl: 'user_details.component.html',
            encapsulation: core_1.ViewEncapsulation.None,
            directives: [date_range_picker_component_1.DateRangePickerComponent, user_details_popup_component_1.UserDetailsPopupComponent, router_1.ROUTER_DIRECTIVES],
            providers: [calculator_analytics_service_1.CalculatorAnalytics]
        }), 
        __metadata('design:paramtypes', [calculator_analytics_service_1.CalculatorAnalytics, index_1.FeatureAuthService])
    ], UserDetailsComponent);
    return UserDetailsComponent;
}());
exports.UserDetailsComponent = UserDetailsComponent;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9zaXRlL2NvbXBvbmVudHMvK2FuYWx5dGljcy9jb21wb25lbnRzL3VzZXJfZGV0YWlscy91c2VyX2RldGFpbHMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxxQkFBaUcsZUFBZSxDQUFDLENBQUE7QUFDakgsNENBQXlDLGtEQUFrRCxDQUFDLENBQUE7QUFDNUYsNkNBQW9DLDZDQUE2QyxDQUFDLENBQUE7QUFDbEYsNkNBQTBDLG9EQUFvRCxDQUFDLENBQUE7QUFFL0Ysc0JBQW1DLHNDQUFzQyxDQUFDLENBQUE7QUFDMUUsdUJBQWtDLGlCQUFpQixDQUFDLENBQUE7QUFjcEQ7SUFpQ0ksOEJBQW9CLG9CQUF5QyxFQUFVLG1CQUF1QztRQUExRix5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXFCO1FBQVUsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFvQjtRQS9COUcsWUFBTyxHQUFVLEVBQUUsQ0FBQztRQUNwQixnQkFBVyxHQUFRLENBQUMsQ0FBQztRQUNyQixjQUFTLEdBQVEsQ0FBQyxDQUFDO1FBRW5CLGNBQVMsR0FBVyxDQUFDLENBQUM7UUFNdEIsZ0JBQVcsR0FBWSxLQUFLLENBQUM7UUFHN0IsV0FBTSxHQUFXLENBQUMsQ0FBQztRQUNuQixhQUFRLEdBQVE7WUFDWixVQUFVLEVBQUUsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDO1lBQzlELFFBQVEsRUFBRSxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUM7U0FDeEQsQ0FBQztRQUNGLGtCQUFhLEdBQVE7WUFDakIsT0FBTyxFQUFFLENBQUM7WUFDVixNQUFNLEVBQUUsQ0FBQztTQUNaLENBQUM7UUFFRixtQkFBYyxHQUFRO1lBQ2xCLFFBQVEsRUFBRSxDQUFDO1lBQ1gsT0FBTyxFQUFFLENBQUM7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QUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDbkQsQ0FBQztJQUNMLENBQUM7SUFFRCwwQ0FBVyxHQUFYO1FBQ0ksSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCwwQ0FBVyxHQUFYO1FBQ0ksSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBQSxHQUFHLElBQUksT0FBQSxHQUFHLENBQUMsV0FBVyxFQUFFLEVBQWpCLENBQWlCLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBeExEO1FBQUMsWUFBSyxFQUFFOztzREFBQTtJQVZaO1FBQUMsZ0JBQVMsQ0FBQztZQUNQLFFBQVEsRUFBRSxNQUFNLENBQUMsRUFBRTtZQUNuQixRQUFRLEVBQUUsaUJBQWlCO1lBQzNCLFdBQVcsRUFBRSw2QkFBNkI7WUFDMUMsYUFBYSxFQUFFLHdCQUFpQixDQUFDLElBQUk7WUFDckMsVUFBVSxFQUFFLENBQUMsc0RBQXdCLEVBQUUsd0RBQXlCLEVBQUUsMEJBQWlCLENBQUM7WUFDcEYsU0FBUyxFQUFFLENBQUMsa0RBQW1CLENBQUM7U0FDbkMsQ0FBQzs7NEJBQUE7SUE0TEYsMkJBQUM7QUFBRCxDQTFMQSxBQTBMQyxJQUFBO0FBMUxZLDRCQUFvQix1QkEwTGhDLENBQUEiLCJmaWxlIjoiYXBwL3NpdGUvY29tcG9uZW50cy8rYW5hbHl0aWNzL2NvbXBvbmVudHMvdXNlcl9kZXRhaWxzL3VzZXJfZGV0YWlscy5jb21wb25lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgVmlld0VuY2Fwc3VsYXRpb24sIElucHV0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEYXRlUmFuZ2VQaWNrZXJDb21wb25lbnQgfSBmcm9tICcuLi9kYXRlX3JhbmdlX3BpY2tlci9kYXRlX3JhbmdlX3BpY2tlci5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBDYWxjdWxhdG9yQW5hbHl0aWNzIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvY2FsY3VsYXRvci1hbmFseXRpY3Muc2VydmljZSc7XHJcbmltcG9ydCB7IFVzZXJEZXRhaWxzUG9wdXBDb21wb25lbnQgfSBmcm9tICcuLi91c2VyX2RldGFpbHNfcG9wdXAvdXNlcl9kZXRhaWxzX3BvcHVwLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMvU3Vic2NyaXB0aW9uJztcclxuaW1wb3J0IHsgRmVhdHVyZUF1dGhTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vc2hhcmVkL3NlcnZpY2VzL2luZGV4JztcclxuaW1wb3J0IHsgUk9VVEVSX0RJUkVDVElWRVMgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xyXG5cclxuZGVjbGFyZSB2YXIgalF1ZXJ5OiBhbnk7XHJcbmRlY2xhcmUgdmFyIG1vbWVudDogYW55O1xyXG5kZWNsYXJlIHZhciBNYXRoOiBhbnk7XHJcbkBDb21wb25lbnQoe1xyXG4gICAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcclxuICAgIHNlbGVjdG9yOiAnb2ctdXNlci1kZXRhaWxzJyxcclxuICAgIHRlbXBsYXRlVXJsOiAndXNlcl9kZXRhaWxzLmNvbXBvbmVudC5odG1sJyxcclxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXHJcbiAgICBkaXJlY3RpdmVzOiBbRGF0ZVJhbmdlUGlja2VyQ29tcG9uZW50LCBVc2VyRGV0YWlsc1BvcHVwQ29tcG9uZW50LCBST1VURVJfRElSRUNUSVZFU10sXHJcbiAgICBwcm92aWRlcnM6IFtDYWxjdWxhdG9yQW5hbHl0aWNzXVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIFVzZXJEZXRhaWxzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XHJcbiAgICBASW5wdXQoKSBjYWxjOiBhbnk7XHJcbiAgICBkYXRhU2V0OiBhbnlbXSA9IFtdO1xyXG4gICAgYXZnQW5zd2VyZWQ6IGFueSA9IDA7XHJcbiAgICBhdmdSZXN1bHQ6IGFueSA9IDA7XHJcbiAgICBhdmdMZW5ndGhUaW1lOiBzdHJpbmc7XHJcbiAgICB0b3RhbFRpbWU6IG51bWJlciA9IDA7XHJcbiAgICBrZXk6IGFueTtcclxuICAgIG1vc3RWaWV3ZWRWaWE6IHN0cmluZztcclxuICAgIG1vc3RWaWV3ZWRPbjogc3RyaW5nO1xyXG4gICAgZGF0YVRhYmxlUmVmOiBhbnk7XHJcbiAgICB2aXNpdG9yS2V5OiBzdHJpbmc7XHJcbiAgICBsaW1pdF9hbGVydDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgbGVhZExpbWl0OiBOdW1iZXI7XHJcbiAgICBjYWxjX2lkOiBzdHJpbmc7XHJcbiAgICBsb2FkZXI6IE51bWJlciA9IDA7XHJcbiAgICBwb3N0RGF0YTogYW55ID0ge1xyXG4gICAgICAgIHN0YXJ0X2RhdGU6IG1vbWVudCgpLnN1YnRyYWN0KDEwLCAnZGF5cycpLmZvcm1hdCgnWVlZWS1NTS1ERCcpLFxyXG4gICAgICAgIGVuZF9kYXRlOiBtb21lbnQoKS5hZGQoMSwgJ2RheScpLmZvcm1hdCgnWVlZWS1NTS1ERCcpXHJcbiAgICB9O1xyXG4gICAgdmlld2VkT25TdGF0czogYW55ID0ge1xyXG4gICAgICAgIGRlc2t0b3A6IDAsXHJcbiAgICAgICAgbW9iaWxlOiAwXHJcbiAgICB9O1xyXG5cclxuICAgIHZpZXdlZFZpYVN0YXRzOiBhbnkgPSB7XHJcbiAgICAgICAgZmFjZWJvb2s6IDAsXHJcbiAgICAgICAgdHdpdHRlcjogMCxcclxuICAgICAgICBkaXJlY3Q6IDBcclxuICAgIH07XHJcblxyXG4gICAgcHJpdmF0ZSBzdWJzOiBTdWJzY3JpcHRpb25bXSA9IFtdO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgX2NhbGN1bGF0b3JBbmFseXRpY3M6IENhbGN1bGF0b3JBbmFseXRpY3MsIHByaXZhdGUgX2ZlYXR1cmVBdXRoU2VydmljZTogRmVhdHVyZUF1dGhTZXJ2aWNlKSB7XHJcbiAgICAgICAgdGhpcy5sZWFkTGltaXQgPSB0aGlzLl9mZWF0dXJlQXV0aFNlcnZpY2UuZmVhdHVyZXMubGVhZHM7XHJcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcImxpbWl0IG9mIGxlYWRzc3Nzc3Nzc3NzXCIsIHRoaXMubGVhZExpbWl0KTtcclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICAgICAgLy9jb2RlXHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIGpRdWVyeShkb2N1bWVudCkub24oJ2NsaWNrJywgJ2EucGFnaW5hdGVfYnV0dG9uJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzZWxmLmluaXRpYWxpemVWaWV3RGV0YWlscygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkgeyB9XHJcblxyXG4gICAgaW5pdGlhbGl6ZVZpZXdEZXRhaWxzKCkge1xyXG4gICAgICAgIGpRdWVyeSgnLnZkJykudW5iaW5kKCkuYmluZCgnY2xpY2snLCAoZXZlbnQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnZpc2l0b3JLZXkgPSBqUXVlcnkoZXZlbnQudGFyZ2V0KS5kYXRhKCdrZXknKTtcclxuICAgICAgICAgICAgLy8gU2xpZGUgcmlnaHRcclxuICAgICAgICAgICAgalF1ZXJ5KCcudXNlci1kZXRhaWwtb3V0ZXInKS50b2dnbGUoJ3NsaWRlJywgeyBkaXJlY3Rpb246ICdyaWdodCcgfSwgNzAwKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcygpIHtcclxuICAgICAgICBpZiAodGhpcy5jYWxjKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNhbGMubGl2ZUFwcClcclxuICAgICAgICAgICAgICAgIHRoaXMuY2FsY19pZCA9IHRoaXMuY2FsYy5faWQ7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHRoaXMuY2FsY19pZCA9IHRoaXMuY2FsYy5wYXJlbnRBcHA7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmxvYWRlciA9IDA7XHJcbiAgICAgICAgICAgIHRoaXMuc3Vicy5wdXNoKHRoaXMuZ2V0TGVhZERhdGEodGhpcy5jYWxjX2lkKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldExlYWREYXRhKGlkOiBhbnkpIHtcclxuICAgICAgICAvKiBnZXQgbGVhZHMgb2YgdXNlciBvbiBwYWdlICovXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NhbGN1bGF0b3JBbmFseXRpY3MuZ2V0TGVhZHMoeyBpZDogaWQsIGRhdGU6IHRoaXMucG9zdERhdGEgfSlcclxuICAgICAgICAgICAgLnN1YnNjcmliZShcclxuICAgICAgICAgICAgKHJlc3BvbnNlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxlYWRMaW1pdCAhPSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YVNldCA9IHJlc3BvbnNlLmRhdGEuc3BsaWNlKDAsIHRoaXMubGVhZExpbWl0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGFTZXQgPSByZXNwb25zZS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMubGltaXRfYWxlcnQgPSByZXNwb25zZS5saW1pdF9jcm9zcztcclxuICAgICAgICAgICAgICAgIHRoaXMuYXZnQW5zd2VyZWQgPSBNYXRoLnJvdW5kKHJlc3BvbnNlLmF2Z0Fuc3dlcnMpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hdmdSZXN1bHQgPSByZXNwb25zZS5hdmdSZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAvKiAtLSAqL1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhU2V0ID0gdGhpcy5kYXRhU2V0Lm1hcChkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN1YnMucHVzaCh0aGlzLmdldEFuYWx5dGljRGF0YShkYXRhKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zaGlmdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmludGlhbGl6ZURhdGF0YWJsZSgpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAoZXJyb3I6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0QW5hbHl0aWNEYXRhKGxlYWQ6IGFueVtdKSB7XHJcbiAgICAgICAgdGhpcy5wb3N0RGF0YS50eXBlID0gJ2xlYWRTdGF0cyc7XHJcbiAgICAgICAgdGhpcy5wb3N0RGF0YS5jYWxjX2lkID0gbGVhZFswXTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY2FsY3VsYXRvckFuYWx5dGljcy5nZXRUcmFmZmljU3RhdHModGhpcy5wb3N0RGF0YSlcclxuICAgICAgICAgICAgLnN1YnNjcmliZShcclxuICAgICAgICAgICAgKHJlc3BvbnNlOiBhbnlbXSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxlYWRbNF0gPSAocmVzcG9uc2VbMF1bNF0gPiA2MCkgPyAocmVzcG9uc2VbMF1bNF0gLyA2MCkudG9GaXhlZCgyKSArICcgbScgOiByZXNwb25zZVswXVs0XSArICcgcyc7XHJcbiAgICAgICAgICAgICAgICAgICAgbGVhZFszXSA9IHJlc3BvbnNlWzBdWzNdO1xyXG4gICAgICAgICAgICAgICAgICAgIGxlYWRbNV0gPSAocmVzcG9uc2VbMF1bMl0gPT0gJyhub3Qgc2V0KScgPyAnZGlyZWN0JyA6IHJlc3BvbnNlWzBdWzJdKTtcclxuICAgICAgICAgICAgICAgICAgICAvL2F2ZyB0aW1lXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50b3RhbFRpbWUgKz0gTnVtYmVyKHJlc3BvbnNlWzBdWzRdKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgYXZnVGltZTogbnVtYmVyID0gdGhpcy50b3RhbFRpbWUgLyB0aGlzLmRhdGFTZXQubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXZnTGVuZ3RoVGltZSA9IChhdmdUaW1lID4gNjApID8gKGF2Z1RpbWUgLyA2MCkudG9GaXhlZCgyKSArICcgbScgOiBhdmdUaW1lLnRvRml4ZWQoMikgKyAnIHMnO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vb3RoZXIgc3RhdHNcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnZpZXdlZE9uU3RhdHNbcmVzcG9uc2VbMF1bM11dICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3ZWRWaWFTdGF0c1tyZXNwb25zZVswXVsyXSA9PSAnKG5vdCBzZXQpJyA/ICdkaXJlY3QnIDogcmVzcG9uc2VbMF1bMl1dICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3N0Vmlld2VkVmlhID0gT2JqZWN0LmtleXModGhpcy52aWV3ZWRWaWFTdGF0cykucmVkdWNlKChhOiBhbnksIGI6IGFueSkgPT4gdGhpcy52aWV3ZWRWaWFTdGF0c1thXSA+IHRoaXMudmlld2VkVmlhU3RhdHNbYl0gPyBhIDogYik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3N0Vmlld2VkT24gPSBPYmplY3Qua2V5cyh0aGlzLnZpZXdlZE9uU3RhdHMpLnJlZHVjZSgoYTogYW55LCBiOiBhbnkpID0+IHRoaXMudmlld2VkT25TdGF0c1thXSA+IHRoaXMudmlld2VkT25TdGF0c1tiXSA/IGEgOiBiKTtcclxuICAgICAgICAgICAgICAgICAgICAvL3JlaW5pdCBkYXRhIHRhYmxlXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnRpYWxpemVEYXRhdGFibGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmdlb0xvYWRlciA9ICdkb25lJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGVhZFszXSA9IGxlYWRbNF0gPSBsZWFkWzVdID0gJ05vdCBBdmFpbGFibGUnO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW50aWFsaXplRGF0YXRhYmxlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5nZW9Mb2FkZXIgPSAnTm8gRGF0YSBBdmFpbGFibGUgISc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmdlb0xvYWRlciA9ICdTb21ldGhpbmcgV2VudCBXcm9uZyAhJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGludGlhbGl6ZURhdGF0YWJsZSgpIHtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgaWYgKHRoaXMuZGF0YVRhYmxlUmVmID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhVGFibGVSZWYgPSBqUXVlcnkoJyNteVRhYmxlJykuRGF0YVRhYmxlKHtcclxuICAgICAgICAgICAgICAgIGRhdGE6IHRoaXMuZGF0YVNldCxcclxuICAgICAgICAgICAgICAgICdzUGFnaW5hdGlvblR5cGUnOiAnZnVsbF9udW1iZXJzJyxcclxuICAgICAgICAgICAgICAgIGxhbmd1YWdlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW1wdHlUYWJsZTogJzxjZW50ZXI+Tm8gZGF0YSBhdmFpbGFibGU8L2NlbnRlcj4nLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicHJldmlvdXNcIjogJzxpIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnNcIj5za2lwX3ByZXZpb3VzPC9pPicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZmlyc3RcIjogJzxpIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnNcIj5rZXlib2FyZF9hcnJvd19sZWZ0PC9pPicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibmV4dFwiOiAnPGkgY2xhc3M9XCJtYXRlcmlhbC1pY29uc1wiPnNraXBfbmV4dDwvaT4nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxhc3RcIjogJzxpIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnNcIj5rZXlib2FyZF9hcnJvd19yaWdodDwvaT4nXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGNvbHVtbnM6IFtcclxuICAgICAgICAgICAgICAgICAgICB7IHRpdGxlOiAnTmFtZScgfSxcclxuICAgICAgICAgICAgICAgICAgICB7IHRpdGxlOiAnUXVlc3Rpb25zIEFuc3dlcmVkJyB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHsgdGl0bGU6IChzZWxmLmNhbGMudGVtcGxhdGVUeXBlID09ICdOdW1lcmljYWwnKSA/ICdSZXN1bHQgT2J0YWluZWQnIDogJ091dGNvbWUgT2J0YWluZWQnIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgeyB0aXRsZTogJ1Zpc2l0ZWQgT24nIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgeyB0aXRsZTogJ0xlbmd0aCBvZiBWaXNpdCcgfSxcclxuICAgICAgICAgICAgICAgICAgICB7IHRpdGxlOiAnVmlzaXRlZCBWaWEnIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgeyB0aXRsZTogJ1ZpZXcgRGV0YWlscycgfVxyXG4gICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGFUYWJsZVJlZi5jbGVhcigpO1xyXG4gICAgICAgICAgICB0aGlzLmRhdGFUYWJsZVJlZi5yb3dzLmFkZCh0aGlzLmRhdGFTZXQpO1xyXG4gICAgICAgICAgICB0aGlzLmRhdGFUYWJsZVJlZi5kcmF3KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vYmluZCBjbGlja1xyXG4gICAgICAgIGpRdWVyeSgnLnZkJykudW5iaW5kKCkuYmluZCgnY2xpY2snLCAoZXZlbnQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnZpc2l0b3JLZXkgPSBqUXVlcnkoZXZlbnQudGFyZ2V0KS5kYXRhKCdrZXknKTtcclxuICAgICAgICAgICAgLy8gU2xpZGUgcmlnaHRcclxuICAgICAgICAgICAgalF1ZXJ5KCcudXNlci1kZXRhaWwtb3V0ZXInKS50b2dnbGUoJ3NsaWRlJywgeyBkaXJlY3Rpb246ICdyaWdodCcgfSwgNzAwKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmxvYWRlciA9IDE7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIG9uRGF0ZVNlbGVjdChkYXRlOiBhbnkpIHtcclxuICAgICAgICB0aGlzLnBvc3REYXRhLnN0YXJ0X2RhdGUgPSBkYXRlLnN0YXJ0X2RhdGU7XHJcbiAgICAgICAgdGhpcy5wb3N0RGF0YS5lbmRfZGF0ZSA9IGRhdGUuZW5kX2RhdGU7XHJcbiAgICAgICAgLy9yZWZyZXNoIHN0YXRzXHJcbiAgICAgICAgaWYgKHRoaXMuY2FsY19pZCkge1xyXG4gICAgICAgICAgICB0aGlzLnN1YnMucHVzaCh0aGlzLmdldExlYWREYXRhKHRoaXMuY2FsY19pZCkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdW5zdWJzY3JpYmUoKSB7XHJcbiAgICAgICAgdGhpcy5zdWJzLmZvckVhY2goc3ViID0+IHN1Yi51bnN1YnNjcmliZSgpKTtcclxuICAgIH1cclxufVxyXG4iXX0=
