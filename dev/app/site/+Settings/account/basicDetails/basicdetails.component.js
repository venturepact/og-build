"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var forms_1 = require('@angular/forms');
var core_1 = require('@angular/core');
var index_1 = require('../../../../shared/services/index');
var user_1 = require('../../../../shared/models/user');
var currentPlan_1 = require('../../../../shared/models/currentPlan');
var email_validator_1 = require('./../../../../shared/validators/email.validator');
var BasicDetailsComponent = (function () {
    function BasicDetailsComponent(_userService, fb, _cookieService, _script, _membershipService) {
        this._userService = _userService;
        this.fb = fb;
        this._cookieService = _cookieService;
        this._script = _script;
        this._membershipService = _membershipService;
        this.model = new user_1.User({});
        this.BillingDetails = new currentPlan_1.Customer(null);
        this.submitted = false;
        this.active = true;
        this.error = false;
        this.success = false;
        this.Message = '';
        this.isPlaceExist = false;
        this.hostnameRegexp = new RegExp('^https?://.+?/');
    }
    BasicDetailsComponent.prototype.ngOnInit = function () {
        jQuery.material.init();
        this.basicDetailsForm = this.fb.group({
            name: [this.model.name, forms_1.Validators.compose([
                    forms_1.Validators.required, forms_1.Validators.minLength(4), forms_1.Validators.pattern('^[a-zA-Z ]*$')
                ])],
            phone: [this.model.phone, forms_1.Validators.compose([
                    forms_1.Validators.pattern('[-+0 -9]+$'), forms_1.Validators.minLength(5)
                ])],
            location: [this.model.location],
            timezone: [this.model.timezone]
        });
        this.emailForm = this.fb.group({
            email: [this.model.emails, forms_1.Validators.compose([
                    forms_1.Validators.required, forms_1.Validators.minLength(4), email_validator_1.EmailValidator.format
                ])],
            password: [this.model.password]
        });
    };
    BasicDetailsComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        this._script.load('googleLocation', 'timeZoneMin')
            .then(function (data) {
            _this.initialize();
            _this.getBasicDetails();
        })
            .catch(function (error) {
        });
    };
    BasicDetailsComponent.prototype.initialize = function () {
        localStorage.removeItem('pid');
        var locationElement = document.getElementById('location');
        this.autocomplete = new google.maps.places.Autocomplete((locationElement), { types: ['(cities)'] });
        var self = this;
        google.maps.event.addListener(self.autocomplete, 'place_changed', function () {
            var place = this.getPlace();
            if (place.place_id) {
                self.isPlaceExist = true;
                self.model.location = place.formatted_address;
                locationElement.value = place.formatted_address;
                localStorage.setItem('pid', self.model.location);
                jQuery('#saveBasicDetails').attr('disabled', false);
            }
        });
    };
    BasicDetailsComponent.prototype.chkLocation = function () {
        var pid = localStorage.getItem('pid');
        var locationElement = document.getElementById('location');
        var self = this;
        if (self.isPlaceExist === false && pid === null) {
            locationElement.value = '';
            localStorage.removeItem('pid');
            jQuery('#saveBasicDetails').attr('disabled', true);
        }
        else {
            jQuery('#saveBasicDetails').attr('disabled', false);
            locationElement.value = pid;
            self.model.location = locationElement.value;
        }
    };
    BasicDetailsComponent.prototype.getBasicDetails = function () {
        var _this = this;
        this.timezones = moment.tz.names();
        for (var timezone in this.timezones) {
            this.timezones[timezone] = this.timezones[timezone] + ' ' + moment.tz(this.timezones[timezone]).format('Z z');
        }
        var self = this;
        self._userService.getBasicDetails()
            .subscribe(function (data) {
            self.model = data;
            if (self.model.timezone.length === 0)
                self.model.timezone = 'Select a Timezone';
            self.model.emails = self.model.emails[0].email;
            _this.user_email = self.model.emails;
            if (self.model.location.length === 0) {
                var pos_1;
                navigator.geolocation.getCurrentPosition(function (position) {
                    pos_1 = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    var latlng = new google.maps.LatLng(pos_1.lat, pos_1.lng);
                    var geocoder = new google.maps.Geocoder();
                    geocoder.geocode({ 'latLng': latlng }, function (results, status) {
                        if (status === google.maps.GeocoderStatus.OK) {
                            if (results[1]) {
                                self.model.location = results[1].formatted_address;
                            }
                        }
                    });
                });
            }
        }, function (response) {
            self.Message = response.error.err_message;
            jQuery('#basicMessageModal').modal('show');
        });
    };
    BasicDetailsComponent.prototype.onSubmit = function () {
        var _this = this;
        jQuery('#saveBasicDetails').html('Please Wait...');
        this._userService.updateBasicDetails(this.model)
            .subscribe(function (data) {
            _this.getBasicDetails();
            _this.updateBiiling();
            jQuery('#saveBasicDetails').html('Update');
            var storage = JSON.parse(_this._cookieService.readCookie('storage'));
            storage.user.name = data.name;
            _this._cookieService.createCookie('storage', JSON.stringify(storage), 3);
            jQuery('.name-title').html('&nbsp;' + data.name);
            window.toastNotification('Basic Details Updated!');
            ga('markettingteam.send', 'event', 'Settings', 'Submit', 'EditInfo');
            _kmq.push(['record', 'Settings Updated account basic info']);
        }, function (response) {
            _this.Message = response.error.err_message;
            jQuery('#saveBasicDetails').html('Update');
        });
    };
    BasicDetailsComponent.prototype.updateBiiling = function () {
        var _this = this;
        var self = this;
        var getPaymentDeatils = self._membershipService.updateCustomer(self.model.name)
            .subscribe(function (success) {
            _this.BillingDetails = new currentPlan_1.Customer(success.customer);
        }, function (error) {
            getPaymentDeatils.unsubscribe();
        });
    };
    BasicDetailsComponent.prototype.setFalse = function () {
        this.error = false;
        this.success = false;
    };
    BasicDetailsComponent.prototype.updateEmail = function () {
        var _this = this;
        jQuery('#updateEmail').html('Please Wait...');
        jQuery('#updateEmail').attr('disabled', true);
        var storage = JSON.parse(this._cookieService.readCookie('storage'));
        if (storage.user.emails[0].email !== this.model.emails) {
            this._userService.updateEmail(storage.user.emails[0].email, this.model.emails, this.model.password)
                .subscribe(function (data) {
                storage.user.emails = data.emails;
                _this._cookieService.createCookie('storage', JSON.stringify(storage), 3);
                _this.getBasicDetails();
                jQuery('#updateEmail').html('Change Email');
                jQuery('#updateEmail').attr('disabled', false);
                jQuery('#change-email').modal('hide');
                _this.Message = 'Email Updated!';
                _this.success = true;
            }, function (response) {
                var error_code = response.error.code;
                if (error_code === 'E_UNIQUE_USERNAME_VALIDATION' ||
                    error_code === 'E_UNIQUE_EMAIL_VALIDATION' ||
                    error_code === 'E_UNIQUE_UNIDENTIFIED_VALIDATION') {
                    _this.Message = ' Email is already registered with us!';
                }
                else if (error_code === 'E_USER_NOT_FOUND') {
                    _this.Message = response.error.message;
                }
                else {
                    _this.Message = (response.error.err_errors['emails.0.email']) ?
                        response.error.err_errors['emails.0.email'].message :
                        response.error.err_message;
                }
                _this.error = true;
                jQuery('#updateEmail').html('Change Email');
                jQuery('#updateEmail').attr('disabled', false);
            });
        }
        else {
            this.error = true;
            jQuery('#updateEmail').html('Change Email');
            jQuery('#updateEmail').attr('disabled', false);
            this.Message = "Com'on atleast change something.";
        }
    };
    BasicDetailsComponent.prototype.callGA = function (opt) {
        switch (opt) {
            case "UPDATEACCOUNT":
                ga('markettingteam.send', 'event', 'Settings', 'Click', 'EditInfo');
                _kmq.push(['record', 'Settings Update account basic info click']);
                break;
        }
    };
    BasicDetailsComponent = __decorate([
        core_1.Component({
            moduleId: module.id,
            selector: 'og-basic-details',
            providers: [index_1.UserService],
            directives: [forms_1.REACTIVE_FORM_DIRECTIVES],
            templateUrl: 'basicdetails.component.html',
            styleUrls: ['basicdetails.component.css']
        }), 
        __metadata('design:paramtypes', [index_1.UserService, forms_1.FormBuilder, index_1.CookieService, index_1.Script, index_1.MembershipService])
    ], BasicDetailsComponent);
    return BasicDetailsComponent;
}());
exports.BasicDetailsComponent = BasicDetailsComponent;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9zaXRlLytTZXR0aW5ncy9hY2NvdW50L2Jhc2ljRGV0YWlscy9iYXNpY2RldGFpbHMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxzQkFBNkUsZ0JBQWdCLENBQUMsQ0FBQTtBQUM5RixxQkFBZ0QsZUFBZSxDQUFDLENBQUE7QUFDaEUsc0JBQXFFLG1DQUFtQyxDQUFDLENBQUE7QUFDekcscUJBQXFCLGdDQUFnQyxDQUFDLENBQUE7QUFDdEQsNEJBQXVCLHVDQUF1QyxDQUFDLENBQUE7QUFDL0QsZ0NBQStCLGlEQUFpRCxDQUFDLENBQUE7QUFrQmpGO0lBbUJFLCtCQUNTLFlBQXlCLEVBQ3hCLEVBQWMsRUFDZCxjQUE4QixFQUM5QixPQUFlLEVBQ2Ysa0JBQW9DO1FBSnJDLGlCQUFZLEdBQVosWUFBWSxDQUFhO1FBQ3hCLE9BQUUsR0FBRixFQUFFLENBQVk7UUFDZCxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDOUIsWUFBTyxHQUFQLE9BQU8sQ0FBUTtRQUNmLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBa0I7UUFwQjlDLFVBQUssR0FBTyxJQUFJLFdBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN6QixtQkFBYyxHQUFhLElBQUksc0JBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM5QyxjQUFTLEdBQUcsS0FBSyxDQUFDO1FBQ2xCLFdBQU0sR0FBRyxJQUFJLENBQUM7UUFDZCxVQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ2QsWUFBTyxHQUFHLEtBQUssQ0FBQztRQUNoQixZQUFPLEdBQU0sRUFBRSxDQUFDO1FBTWhCLGlCQUFZLEdBQVksS0FBSyxDQUFFO1FBQ2hDLG1CQUFjLEdBQVksSUFBSSxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztJQVN0RCxDQUFDO0lBRUQsd0NBQVEsR0FBUjtRQUNFLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDO1lBQ3BDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLGtCQUFVLENBQUMsT0FBTyxDQUFDO29CQUN6QyxrQkFBVSxDQUFDLFFBQVEsRUFBQyxrQkFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBQyxrQkFBVSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUM7aUJBQy9FLENBQUMsQ0FBQztZQUNILEtBQUssRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLGtCQUFVLENBQUMsT0FBTyxDQUFDO29CQUMzQyxrQkFBVSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsRUFBQyxrQkFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7aUJBQ3pELENBQUMsQ0FBQztZQUNILFFBQVEsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDO1lBQy9CLFFBQVEsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDO1NBQ2hDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUM7WUFDN0IsS0FBSyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsa0JBQVUsQ0FBQyxPQUFPLENBQUM7b0JBQzVDLGtCQUFVLENBQUMsUUFBUSxFQUFDLGtCQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFDLGdDQUFjLENBQUMsTUFBTTtpQkFDbEUsQ0FBQyxDQUFDO1lBQ0gsUUFBUSxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUM7U0FDaEMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELCtDQUFlLEdBQWY7UUFBQSxpQkFVQztRQVRDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFDLGFBQWEsQ0FBQzthQUM1QyxJQUFJLENBQUMsVUFBQyxJQUFRO1lBQ1gsS0FBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQ2xCLEtBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUUzQixDQUFDLENBQUM7YUFDRCxLQUFLLENBQUMsVUFBQyxLQUFLO1FBRWpCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELDBDQUFVLEdBQVY7UUFDRSxZQUFZLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQy9CLElBQUksZUFBZSxHQUFRLFFBQVEsQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDakUsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FDdEQsQ0FBQyxlQUFlLENBQUMsRUFDakIsRUFBQyxLQUFLLEVBQUUsQ0FBQyxVQUFVLENBQUMsRUFBQyxDQUNyQixDQUFDO1FBQ0EsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLGVBQWUsRUFBRztZQUMvRCxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDNUIsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7Z0JBQ25CLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO2dCQUN6QixJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUMsaUJBQWlCLENBQUM7Z0JBQzlDLGVBQWUsQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLGlCQUFpQixDQUFDO2dCQUNoRCxZQUFZLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUNoRCxNQUFNLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3JELENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNOLENBQUM7SUFFQSwyQ0FBVyxHQUFYO1FBQ0UsSUFBSSxHQUFHLEdBQUksWUFBWSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN2QyxJQUFJLGVBQWUsR0FBUyxRQUFRLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ2hFLElBQUksSUFBSSxHQUFHLElBQUksQ0FBRTtRQUNqQixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsWUFBWSxLQUFLLEtBQUssSUFBSSxHQUFHLEtBQUssSUFBSyxDQUFDLENBQUMsQ0FBQztZQUM5QyxlQUFlLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztZQUMzQixZQUFZLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQy9CLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEQsQ0FBQztRQUFBLElBQUksQ0FBQyxDQUFDO1lBQ0wsTUFBTSxDQUFDLG1CQUFtQixDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBQyxLQUFLLENBQUMsQ0FBQztZQUNuRCxlQUFlLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQztZQUM1QixJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsR0FBRyxlQUFlLENBQUMsS0FBSyxDQUFDO1FBQzlDLENBQUM7SUFDTCxDQUFDO0lBRUQsK0NBQWUsR0FBZjtRQUFBLGlCQWlEQztRQWhEQyxJQUFJLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLENBQUM7UUFFbkMsR0FBRyxDQUFBLENBQUMsSUFBSSxRQUFRLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDbkMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxHQUFFLEdBQUcsR0FBRSxNQUFNLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7UUFHOUcsQ0FBQztRQUVELElBQUksSUFBSSxHQUFPLElBQUksQ0FBQztRQUNwQixJQUFJLENBQUMsWUFBWSxDQUFDLGVBQWUsRUFBRTthQUNqQixTQUFTLENBQ1IsVUFBQyxJQUFVO1lBQ1IsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7WUFDbEIsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztnQkFDbEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEdBQUcsbUJBQW1CLENBQUM7WUFDNUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1lBQy9DLEtBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUM7WUFDcEMsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBUXBDLElBQUksS0FBUyxDQUFDO2dCQUNkLFNBQVMsQ0FBQyxXQUFXLENBQUMsa0JBQWtCLENBQUMsVUFBUyxRQUFRO29CQUN4RCxLQUFHLEdBQUc7d0JBQ0osR0FBRyxFQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsUUFBUTt3QkFDN0IsR0FBRyxFQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUztxQkFDL0IsQ0FBQztvQkFDRixJQUFJLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUcsQ0FBQyxHQUFHLEVBQUUsS0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUN0RCxJQUFJLFFBQVEsR0FBRyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7b0JBQzFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLEVBQUUsVUFBVSxPQUFXLEVBQUUsTUFBVTt3QkFDcEUsRUFBRSxDQUFDLENBQUMsTUFBTSxLQUFLLE1BQU0sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7NEJBQzNDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0NBQ2IsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDOzRCQUN2RCxDQUFDO3dCQUNMLENBQUM7b0JBQ0wsQ0FBQyxDQUFDLENBQUM7Z0JBQ0wsQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDO1FBQ0gsQ0FBQyxFQUNGLFVBQUMsUUFBWTtZQUNWLElBQUksQ0FBQyxPQUFPLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUM7WUFDMUMsTUFBTSxDQUFDLG9CQUFvQixDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzdDLENBQUMsQ0FDRixDQUFDO0lBQ3RCLENBQUM7SUFFRCx3Q0FBUSxHQUFSO1FBQUEsaUJBdUJDO1FBdEJDLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ25ELElBQUksQ0FBQyxZQUFZLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQzthQUM5QixTQUFTLENBQ1IsVUFBQyxJQUFVO1lBQ1IsS0FBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQ3ZCLEtBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUNyQixNQUFNLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDM0MsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFJLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ3BFLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7WUFDOUIsS0FBSSxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEUsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLEdBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQy9DLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1lBRW5ELEVBQUUsQ0FBQyxxQkFBcUIsRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxVQUFVLENBQUMsQ0FBQztZQUNyRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxFQUFFLHFDQUFxQyxDQUFDLENBQUMsQ0FBQztRQUUvRCxDQUFDLEVBQ0YsVUFBQyxRQUFZO1lBQ1YsS0FBSSxDQUFDLE9BQU8sR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQztZQUMxQyxNQUFNLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDN0MsQ0FBQyxDQUNGLENBQUM7SUFDdEIsQ0FBQztJQUVELDZDQUFhLEdBQWI7UUFBQSxpQkFZQztRQVhBLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLGlCQUFpQixHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7YUFDN0UsU0FBUyxDQUNULFVBQUMsT0FBWTtZQUNaLEtBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxzQkFBUSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN0RCxDQUFDLEVBQ0QsVUFBQyxLQUFTO1lBRU4saUJBQWlCLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDcEMsQ0FBQyxDQUNELENBQUM7SUFDSCxDQUFDO0lBRUQsd0NBQVEsR0FBUjtRQUNFLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLElBQUksQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDO0lBQ3ZCLENBQUM7SUFFRCwyQ0FBVyxHQUFYO1FBQUEsaUJBK0NDO1FBOUNDLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUM5QyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBQyxJQUFJLENBQUMsQ0FBQztRQUM3QyxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDcEUsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUEsQ0FBQztZQUNyRCxJQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUM7aUJBQ2hHLFNBQVMsQ0FDUixVQUFDLElBQVU7Z0JBR1QsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztnQkFDbEMsS0FBSSxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RFLEtBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztnQkFDdkIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztnQkFDNUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQzlDLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ3RDLEtBQUksQ0FBQyxPQUFPLEdBQUcsZ0JBQWdCLENBQUM7Z0JBQ2hDLEtBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1lBQ3RCLENBQUMsRUFDRCxVQUFDLFFBQVk7Z0JBQ1gsSUFBSSxVQUFVLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7Z0JBQ3JDLEVBQUUsQ0FBQSxDQUFDLFVBQVUsS0FBSyw4QkFBOEI7b0JBQzlDLFVBQVUsS0FBRywyQkFBMkI7b0JBQ3hDLFVBQVUsS0FBRyxrQ0FDZixDQUFDLENBQUMsQ0FBQztvQkFDRCxLQUFJLENBQUMsT0FBTyxHQUFHLHVDQUF1QyxDQUFDO2dCQUN6RCxDQUFDO2dCQUNELElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxVQUFVLEtBQUssa0JBQWtCLENBQUMsQ0FBQSxDQUFDO29CQUN6QyxLQUFJLENBQUMsT0FBTyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDO2dCQUN4QyxDQUFDO2dCQUNELElBQUksQ0FBQSxDQUFDO29CQUNILEtBQUksQ0FBQyxPQUFPLEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO3dCQUMxRCxRQUFRLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLE9BQU87d0JBQ25ELFFBQVEsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFFO2dCQUNoQyxDQUFDO2dCQUNELEtBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO2dCQUNsQixNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO2dCQUM1QyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBQyxLQUFLLENBQUMsQ0FBQztZQUNoRCxDQUFDLENBQ0YsQ0FBQztRQUNKLENBQUM7UUFBQSxJQUFJLENBQUMsQ0FBQztZQUNMLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1lBQ2xCLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7WUFDNUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUMsS0FBSyxDQUFDLENBQUM7WUFDOUMsSUFBSSxDQUFDLE9BQU8sR0FBRyxrQ0FBa0MsQ0FBQztRQUNwRCxDQUFDO0lBRUgsQ0FBQztJQUVELHNDQUFNLEdBQU4sVUFBTyxHQUFXO1FBQ2hCLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDWixLQUFLLGVBQWU7Z0JBQ2xCLEVBQUUsQ0FBQyxxQkFBcUIsRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxVQUFVLENBQUMsQ0FBQztnQkFDcEUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsRUFBRSwwQ0FBMEMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2xFLEtBQUssQ0FBQztRQUNWLENBQUM7SUFDSCxDQUFDO0lBL1BIO1FBQUMsZ0JBQVMsQ0FBQztZQUNULFFBQVEsRUFBTSxNQUFNLENBQUMsRUFBRTtZQUN2QixRQUFRLEVBQU0sa0JBQWtCO1lBQ2hDLFNBQVMsRUFBSyxDQUFDLG1CQUFXLENBQUM7WUFDM0IsVUFBVSxFQUFJLENBQUMsZ0NBQXdCLENBQUM7WUFDeEMsV0FBVyxFQUFHLDZCQUE2QjtZQUM1QyxTQUFTLEVBQUssQ0FBQyw0QkFBNEIsQ0FBQztTQUM1QyxDQUFDOzs2QkFBQTtJQThQRiw0QkFBQztBQUFELENBNVBBLEFBNFBDLElBQUE7QUE1UFksNkJBQXFCLHdCQTRQakMsQ0FBQSIsImZpbGUiOiJhcHAvc2l0ZS8rU2V0dGluZ3MvYWNjb3VudC9iYXNpY0RldGFpbHMvYmFzaWNkZXRhaWxzLmNvbXBvbmVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJFQUNUSVZFX0ZPUk1fRElSRUNUSVZFUywgVmFsaWRhdG9ycywgRm9ybUJ1aWxkZXIsIEZvcm1Hcm91cCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgQ29tcG9uZW50LE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBVc2VyU2VydmljZSxDb29raWVTZXJ2aWNlLCBTY3JpcHQsIE1lbWJlcnNoaXBTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2hhcmVkL3NlcnZpY2VzL2luZGV4JztcclxuaW1wb3J0IHsgVXNlciB9IGZyb20gJy4uLy4uLy4uLy4uL3NoYXJlZC9tb2RlbHMvdXNlcic7XHJcbmltcG9ydCB7Q3VzdG9tZXJ9IGZyb20gJy4uLy4uLy4uLy4uL3NoYXJlZC9tb2RlbHMvY3VycmVudFBsYW4nO1xyXG5pbXBvcnQgeyBFbWFpbFZhbGlkYXRvciB9IGZyb20gJy4vLi4vLi4vLi4vLi4vc2hhcmVkL3ZhbGlkYXRvcnMvZW1haWwudmFsaWRhdG9yJztcclxuXHJcbmRlY2xhcmUgdmFyIGpRdWVyeTphbnk7XHJcbmRlY2xhcmUgdmFyIG1vbWVudDphbnk7XHJcbmRlY2xhcmUgdmFyIGdvb2dsZTphbnk7XHJcbmRlY2xhcmUgdmFyIGdhOmFueTtcclxuZGVjbGFyZSB2YXIgX2ttcTphbnk7XHJcbmRlY2xhcmUgdmFyIHdpbmRvdzogYW55O1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgbW9kdWxlSWQgICAgOiBtb2R1bGUuaWQsXHJcbiAgc2VsZWN0b3IgICAgOiAnb2ctYmFzaWMtZGV0YWlscycsXHJcbiAgcHJvdmlkZXJzICAgOiBbVXNlclNlcnZpY2VdLFxyXG4gIGRpcmVjdGl2ZXMgIDogW1JFQUNUSVZFX0ZPUk1fRElSRUNUSVZFU10sXHJcbiAgdGVtcGxhdGVVcmwgOiAnYmFzaWNkZXRhaWxzLmNvbXBvbmVudC5odG1sJyxcclxuXHRzdHlsZVVybHMgICA6IFsnYmFzaWNkZXRhaWxzLmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIEJhc2ljRGV0YWlsc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCxBZnRlclZpZXdJbml0IHtcclxuICBiYXNpY0RldGFpbHNGb3JtOiBGb3JtR3JvdXA7XHJcbiAgZW1haWxGb3JtOkZvcm1Hcm91cDtcclxuICB0aW1lem9uZXMgOlN0cmluZztcclxuICBtb2RlbDphbnkgPSBuZXcgVXNlcih7fSk7XHJcbiAgQmlsbGluZ0RldGFpbHM6IEN1c3RvbWVyID0gbmV3IEN1c3RvbWVyKG51bGwpO1xyXG4gIHN1Ym1pdHRlZCA9IGZhbHNlO1xyXG4gIGFjdGl2ZSA9IHRydWU7XHJcbiAgZXJyb3IgPSBmYWxzZTtcclxuICBzdWNjZXNzID0gZmFsc2U7XHJcbiAgTWVzc2FnZTphbnkgPScnO1xyXG4gIHVzZXJfZW1haWwgOiBTdHJpbmc7XHJcbiAgYXV0b2NvbXBsZXRlc3AgOiBhbnk7XHJcbiAgYXV0b2NvbXBsZXRlICAgOiBhbnk7XHJcbiAgbG9jYXRpb25JZCA6YW55IDtcclxuICBhZGRyZXNzIDphbnkgO1xyXG4gIGlzUGxhY2VFeGlzdCA6Qm9vbGVhbiA9IGZhbHNlIDtcclxuXHRob3N0bmFtZVJlZ2V4cCA6IFJlZ0V4cFx0PSBuZXcgUmVnRXhwKCdeaHR0cHM/Oi8vLis/LycpO1xyXG4gIC8vIEBIb3N0QmluZGluZygnY2xhc3Muc29tZUNsYXNzJykgc29tZUZpZWxkOiBib29sID0gZmFsc2U7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwdWJsaWMgX3VzZXJTZXJ2aWNlOiBVc2VyU2VydmljZSxcclxuICAgIHByaXZhdGUgZmI6Rm9ybUJ1aWxkZXIsXHJcbiAgICBwcml2YXRlIF9jb29raWVTZXJ2aWNlIDogQ29va2llU2VydmljZSxcclxuICAgIHByaXZhdGUgX3NjcmlwdCA6U2NyaXB0LFxyXG4gICAgcHJpdmF0ZSBfbWVtYmVyc2hpcFNlcnZpY2U6TWVtYmVyc2hpcFNlcnZpY2VcclxuICApIHtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgalF1ZXJ5Lm1hdGVyaWFsLmluaXQoKTtcclxuICAgIHRoaXMuYmFzaWNEZXRhaWxzRm9ybSA9IHRoaXMuZmIuZ3JvdXAoe1xyXG4gICAgICBuYW1lOiBbdGhpcy5tb2RlbC5uYW1lLCBWYWxpZGF0b3JzLmNvbXBvc2UoW1xyXG4gICAgICAgIFZhbGlkYXRvcnMucmVxdWlyZWQsVmFsaWRhdG9ycy5taW5MZW5ndGgoNCksVmFsaWRhdG9ycy5wYXR0ZXJuKCdeW2EtekEtWiBdKiQnKVxyXG4gICAgICBdKV0sXHJcbiAgICAgIHBob25lOiBbdGhpcy5tb2RlbC5waG9uZSwgVmFsaWRhdG9ycy5jb21wb3NlKFtcclxuICAgICAgICBWYWxpZGF0b3JzLnBhdHRlcm4oJ1stKzAgLTldKyQnKSxWYWxpZGF0b3JzLm1pbkxlbmd0aCg1KVxyXG4gICAgICBdKV0sXHJcbiAgICAgIGxvY2F0aW9uOiBbdGhpcy5tb2RlbC5sb2NhdGlvbl0sXHJcbiAgICAgIHRpbWV6b25lOiBbdGhpcy5tb2RlbC50aW1lem9uZV1cclxuICAgIH0pO1xyXG4gICAgdGhpcy5lbWFpbEZvcm0gPSB0aGlzLmZiLmdyb3VwKHtcclxuICAgICAgZW1haWw6IFt0aGlzLm1vZGVsLmVtYWlscywgVmFsaWRhdG9ycy5jb21wb3NlKFtcclxuICAgICAgICBWYWxpZGF0b3JzLnJlcXVpcmVkLFZhbGlkYXRvcnMubWluTGVuZ3RoKDQpLEVtYWlsVmFsaWRhdG9yLmZvcm1hdFxyXG4gICAgICBdKV0sXHJcbiAgICAgIHBhc3N3b3JkOiBbdGhpcy5tb2RlbC5wYXNzd29yZF1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgdGhpcy5fc2NyaXB0LmxvYWQoJ2dvb2dsZUxvY2F0aW9uJywndGltZVpvbmVNaW4nKVxyXG4gICAgICAgIC50aGVuKChkYXRhOmFueSApPT57XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmdldEJhc2ljRGV0YWlscygpO1xyXG5cclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpPT57XHJcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ1NjcmlwdCBub3QgbG9hZGVkJywgZXJyb3IpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBpbml0aWFsaXplKCkge1xyXG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ3BpZCcpO1xyXG4gICAgbGV0IGxvY2F0aW9uRWxlbWVudCA6YW55ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvY2F0aW9uJyk7XHJcblx0XHR0aGlzLmF1dG9jb21wbGV0ZSA9IG5ldyBnb29nbGUubWFwcy5wbGFjZXMuQXV0b2NvbXBsZXRlKFxyXG5cdFx0XHQobG9jYXRpb25FbGVtZW50KSxcclxuXHRcdFx0e3R5cGVzOiBbJyhjaXRpZXMpJ119XHJcblx0XHQpO1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cdFx0Z29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoc2VsZi5hdXRvY29tcGxldGUsICdwbGFjZV9jaGFuZ2VkJywgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgbGV0IHBsYWNlID0gdGhpcy5nZXRQbGFjZSgpO1xyXG4gICAgICBpZiAocGxhY2UucGxhY2VfaWQpIHtcclxuICAgICAgICBzZWxmLmlzUGxhY2VFeGlzdCA9IHRydWU7XHJcbiAgICAgICAgc2VsZi5tb2RlbC5sb2NhdGlvbiA9IHBsYWNlLmZvcm1hdHRlZF9hZGRyZXNzO1xyXG4gICAgICAgIGxvY2F0aW9uRWxlbWVudC52YWx1ZSA9IHBsYWNlLmZvcm1hdHRlZF9hZGRyZXNzO1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwaWQnLHNlbGYubW9kZWwubG9jYXRpb24pO1xyXG4gICAgICAgIGpRdWVyeSgnI3NhdmVCYXNpY0RldGFpbHMnKS5hdHRyKCdkaXNhYmxlZCcsZmFsc2UpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHR9XHJcblxyXG4gIGNoa0xvY2F0aW9uKCkge1xyXG4gICAgbGV0IHBpZCAgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncGlkJyk7XHJcbiAgICBsZXQgbG9jYXRpb25FbGVtZW50ICA6YW55ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvY2F0aW9uJyk7XHJcbiAgICBsZXQgc2VsZiA9IHRoaXMgO1xyXG4gICAgaWYoc2VsZi5pc1BsYWNlRXhpc3QgPT09IGZhbHNlICYmIHBpZCA9PT0gbnVsbCApIHtcclxuICAgICAgICBsb2NhdGlvbkVsZW1lbnQudmFsdWUgPSAnJztcclxuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgncGlkJyk7XHJcbiAgICAgICAgalF1ZXJ5KCcjc2F2ZUJhc2ljRGV0YWlscycpLmF0dHIoJ2Rpc2FibGVkJyx0cnVlKTtcclxuICAgICAgfWVsc2Uge1xyXG4gICAgICAgIGpRdWVyeSgnI3NhdmVCYXNpY0RldGFpbHMnKS5hdHRyKCdkaXNhYmxlZCcsZmFsc2UpO1xyXG4gICAgICAgIGxvY2F0aW9uRWxlbWVudC52YWx1ZSA9IHBpZDtcclxuICAgICAgICBzZWxmLm1vZGVsLmxvY2F0aW9uID0gbG9jYXRpb25FbGVtZW50LnZhbHVlO1xyXG4gICAgICB9XHJcbiAgfVxyXG5cclxuICBnZXRCYXNpY0RldGFpbHMoKSB7XHJcbiAgICB0aGlzLnRpbWV6b25lcyA9IG1vbWVudC50ei5uYW1lcygpO1xyXG4gICAgLy8gY29uc29sZS5sb2coXCJ0aW1lem9uZXMgYmVmb3JlICBcIix0aGlzLnRpbWV6b25lcyk7XHJcbiAgICBmb3IobGV0IHRpbWV6b25lIGluIHRoaXMudGltZXpvbmVzKSB7XHJcbiAgICAgIHRoaXMudGltZXpvbmVzW3RpbWV6b25lXSA9IHRoaXMudGltZXpvbmVzW3RpbWV6b25lXSArJyAnKyBtb21lbnQudHoodGhpcy50aW1lem9uZXNbdGltZXpvbmVdKS5mb3JtYXQoJ1ogeicpO1xyXG4gICAgICAvLyB0aW1lem9uZSA9IHRpbWV6b25lICsnICcrIG1vbWVudC50eih0aW1lem9uZSkuZm9ybWF0KCdaIHonKTtcclxuICAgICAgLy8gY29uc29sZS5sb2coXCJ0aW1lem9uZVwiLCB0aGlzLnRpbWV6b25lc1t0aW1lem9uZV0sIFwiICAgICAgIFwiKTtcclxuICAgIH1cclxuICAgIC8vIGNvbnNvbGUubG9nKFwidGltZXpvbmVzIGFmdGVyd2FyZHMgIFwiLHRoaXMudGltZXpvbmVzKTtcclxuICAgIGxldCBzZWxmOmFueSA9IHRoaXM7XHJcbiAgICBzZWxmLl91c2VyU2VydmljZS5nZXRCYXNpY0RldGFpbHMoKVxyXG4gICAgICAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgIChkYXRhIDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5tb2RlbCA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2VsZi5tb2RlbC50aW1lem9uZS5sZW5ndGggPT09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm1vZGVsLnRpbWV6b25lID0gJ1NlbGVjdCBhIFRpbWV6b25lJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm1vZGVsLmVtYWlscyA9IHNlbGYubW9kZWwuZW1haWxzWzBdLmVtYWlsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXNlcl9lbWFpbCA9IHNlbGYubW9kZWwuZW1haWxzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNlbGYubW9kZWwubG9jYXRpb24ubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBqUXVlcnkuZ2V0SlNPTignLy9mcmVlZ2VvaXAubmV0L2pzb24vP2NhbGxiYWNrPT8nLCBmdW5jdGlvbihkYXRhOmFueSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICBpcCA9IGRhdGEuaXA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgIHNlbGYubW9kZWwubG9jYXRpb24gPSBkYXRhLmNpdHkrJywgJytkYXRhLnJlZ2lvbl9uYW1lKycgJytkYXRhLnppcF9jb2RlKycsICcrZGF0YS5jb3VudHJ5X25hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGpRdWVyeS5nZXRKU09OKCcvL2dlb3BsdWdpbi5uZXQvanNvbi5ncD9qc29uY2FsbGJhY2s9P2lwPScraXAsZnVuY3Rpb24oZGF0YTphbnkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICBjb25zb2xlLmxvZygnbG9jYXRpb24gZGF0YScsZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwb3MgOiBhbnk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKGZ1bmN0aW9uKHBvc2l0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXQ6IHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsbmc6IHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGxhdGxuZyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcocG9zLmxhdCwgcG9zLmxuZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBnZW9jb2RlciA9IG5ldyBnb29nbGUubWFwcy5HZW9jb2RlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW9jb2Rlci5nZW9jb2RlKHsgJ2xhdExuZyc6IGxhdGxuZyB9LCBmdW5jdGlvbiAocmVzdWx0czphbnksIHN0YXR1czphbnkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IGdvb2dsZS5tYXBzLkdlb2NvZGVyU3RhdHVzLk9LKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdHNbMV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5tb2RlbC5sb2NhdGlvbiA9IHJlc3VsdHNbMV0uZm9ybWF0dGVkX2FkZHJlc3M7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAocmVzcG9uc2U6YW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5NZXNzYWdlID0gcmVzcG9uc2UuZXJyb3IuZXJyX21lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KCcjYmFzaWNNZXNzYWdlTW9kYWwnKS5tb2RhbCgnc2hvdycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gIH1cclxuXHJcbiAgb25TdWJtaXQoKSB7XHJcbiAgICBqUXVlcnkoJyNzYXZlQmFzaWNEZXRhaWxzJykuaHRtbCgnUGxlYXNlIFdhaXQuLi4nKTtcclxuICAgIHRoaXMuX3VzZXJTZXJ2aWNlLnVwZGF0ZUJhc2ljRGV0YWlscyh0aGlzLm1vZGVsKVxyXG4gICAgICAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgIChkYXRhIDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRCYXNpY0RldGFpbHMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUJpaWxpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoJyNzYXZlQmFzaWNEZXRhaWxzJykuaHRtbCgnVXBkYXRlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHN0b3JhZ2UgPSBKU09OLnBhcnNlKHRoaXMuX2Nvb2tpZVNlcnZpY2UucmVhZENvb2tpZSgnc3RvcmFnZScpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9yYWdlLnVzZXIubmFtZSA9IGRhdGEubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb29raWVTZXJ2aWNlLmNyZWF0ZUNvb2tpZSgnc3RvcmFnZScsSlNPTi5zdHJpbmdpZnkoc3RvcmFnZSksMyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KCcubmFtZS10aXRsZScpLmh0bWwoJyZuYnNwOycrZGF0YS5uYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cudG9hc3ROb3RpZmljYXRpb24oJ0Jhc2ljIERldGFpbHMgVXBkYXRlZCEnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAvKi0tLS0gVHJhY2tpbmcgY29kZSBnb2VzIGhlcmUgLS0tLSovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZ2EoJ21hcmtldHRpbmd0ZWFtLnNlbmQnLCAnZXZlbnQnLCAnU2V0dGluZ3MnLCAnU3VibWl0JywgJ0VkaXRJbmZvJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgX2ttcS5wdXNoKFsncmVjb3JkJywgJ1NldHRpbmdzIFVwZGF0ZWQgYWNjb3VudCBiYXNpYyBpbmZvJ10pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAocmVzcG9uc2U6YW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5NZXNzYWdlID0gcmVzcG9uc2UuZXJyb3IuZXJyX21lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KCcjc2F2ZUJhc2ljRGV0YWlscycpLmh0bWwoJ1VwZGF0ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gIH1cclxuXHJcbiAgdXBkYXRlQmlpbGluZygpe1xyXG5cdCBcdGxldCBzZWxmID0gdGhpcztcclxuXHRcdGxldCBnZXRQYXltZW50RGVhdGlscyA9IHNlbGYuX21lbWJlcnNoaXBTZXJ2aWNlLnVwZGF0ZUN1c3RvbWVyKHNlbGYubW9kZWwubmFtZSlcclxuXHRcdFx0LnN1YnNjcmliZShcclxuXHRcdFx0XHQoc3VjY2VzczogYW55KSA9PiB7XHJcblx0XHRcdFx0XHR0aGlzLkJpbGxpbmdEZXRhaWxzID0gbmV3IEN1c3RvbWVyKHN1Y2Nlc3MuY3VzdG9tZXIpO1xyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0KGVycm9yOmFueSkgPT4ge1xyXG5cdFx0XHRcdC8vY29uc29sZS5sb2coJ2Vycm9yJyxlcnJvcik7XHJcbiAgICAgICAgZ2V0UGF5bWVudERlYXRpbHMudW5zdWJzY3JpYmUoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdCk7XHJcblx0IH1cclxuXHJcbiAgc2V0RmFsc2UoKSB7XHJcbiAgICB0aGlzLmVycm9yID0gZmFsc2U7XHJcbiAgICB0aGlzLnN1Y2Nlc3MgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZUVtYWlsKCkge1xyXG4gICAgalF1ZXJ5KCcjdXBkYXRlRW1haWwnKS5odG1sKCdQbGVhc2UgV2FpdC4uLicpO1xyXG4gICAgalF1ZXJ5KCcjdXBkYXRlRW1haWwnKS5hdHRyKCdkaXNhYmxlZCcsdHJ1ZSk7XHJcbiAgICBsZXQgc3RvcmFnZSA9IEpTT04ucGFyc2UodGhpcy5fY29va2llU2VydmljZS5yZWFkQ29va2llKCdzdG9yYWdlJykpO1xyXG4gICAgaWYoc3RvcmFnZS51c2VyLmVtYWlsc1swXS5lbWFpbCAhPT0gdGhpcy5tb2RlbC5lbWFpbHMpe1xyXG4gICAgICB0aGlzLl91c2VyU2VydmljZS51cGRhdGVFbWFpbChzdG9yYWdlLnVzZXIuZW1haWxzWzBdLmVtYWlsLHRoaXMubW9kZWwuZW1haWxzLHRoaXMubW9kZWwucGFzc3dvcmQpXHJcbiAgICAgIC5zdWJzY3JpYmUoXHJcbiAgICAgICAgKGRhdGEgOiBhbnkpID0+IHtcclxuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdVUERBVEUgRU1BSUwgb25lJywgc3RvcmFnZS51c2VyLmVtYWlscyk7XHJcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnVVBEQVRFIEVNQUlMIHR3bycsIGRhdGEuZW1haWxzKTtcclxuICAgICAgICAgIHN0b3JhZ2UudXNlci5lbWFpbHMgPSBkYXRhLmVtYWlscztcclxuICAgICAgICAgIHRoaXMuX2Nvb2tpZVNlcnZpY2UuY3JlYXRlQ29va2llKCdzdG9yYWdlJyxKU09OLnN0cmluZ2lmeShzdG9yYWdlKSwzKTtcclxuICAgICAgICAgIHRoaXMuZ2V0QmFzaWNEZXRhaWxzKCk7XHJcbiAgICAgICAgICBqUXVlcnkoJyN1cGRhdGVFbWFpbCcpLmh0bWwoJ0NoYW5nZSBFbWFpbCcpO1xyXG4gICAgICAgICAgalF1ZXJ5KCcjdXBkYXRlRW1haWwnKS5hdHRyKCdkaXNhYmxlZCcsZmFsc2UpO1xyXG4gICAgICAgICAgalF1ZXJ5KCcjY2hhbmdlLWVtYWlsJykubW9kYWwoJ2hpZGUnKTtcclxuICAgICAgICAgIHRoaXMuTWVzc2FnZSA9ICdFbWFpbCBVcGRhdGVkISc7XHJcbiAgICAgICAgICB0aGlzLnN1Y2Nlc3MgPSB0cnVlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgKHJlc3BvbnNlOmFueSkgPT4ge1xyXG4gICAgICAgICAgbGV0IGVycm9yX2NvZGUgPSByZXNwb25zZS5lcnJvci5jb2RlO1xyXG4gICAgICAgICAgaWYoZXJyb3JfY29kZSA9PT0gJ0VfVU5JUVVFX1VTRVJOQU1FX1ZBTElEQVRJT04nIHx8XHJcbiAgICAgICAgICAgIGVycm9yX2NvZGU9PT0nRV9VTklRVUVfRU1BSUxfVkFMSURBVElPTicgfHxcclxuICAgICAgICAgICAgZXJyb3JfY29kZT09PSdFX1VOSVFVRV9VTklERU5USUZJRURfVkFMSURBVElPTidcclxuICAgICAgICAgICkge1xyXG4gICAgICAgICAgICB0aGlzLk1lc3NhZ2UgPSAnIEVtYWlsIGlzIGFscmVhZHkgcmVnaXN0ZXJlZCB3aXRoIHVzISc7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIGlmKGVycm9yX2NvZGUgPT09ICdFX1VTRVJfTk9UX0ZPVU5EJyl7XHJcbiAgICAgICAgICAgIHRoaXMuTWVzc2FnZSA9IHJlc3BvbnNlLmVycm9yLm1lc3NhZ2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICB0aGlzLk1lc3NhZ2UgPSAocmVzcG9uc2UuZXJyb3IuZXJyX2Vycm9yc1snZW1haWxzLjAuZW1haWwnXSkgP1xyXG4gICAgICAgICAgICAgIHJlc3BvbnNlLmVycm9yLmVycl9lcnJvcnNbJ2VtYWlscy4wLmVtYWlsJ10ubWVzc2FnZSA6XHJcbiAgICAgICAgICAgICAgcmVzcG9uc2UuZXJyb3IuZXJyX21lc3NhZ2UgO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy5lcnJvciA9IHRydWU7XHJcbiAgICAgICAgICBqUXVlcnkoJyN1cGRhdGVFbWFpbCcpLmh0bWwoJ0NoYW5nZSBFbWFpbCcpO1xyXG4gICAgICAgICAgalF1ZXJ5KCcjdXBkYXRlRW1haWwnKS5hdHRyKCdkaXNhYmxlZCcsZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgKTtcclxuICAgIH1lbHNlIHtcclxuICAgICAgdGhpcy5lcnJvciA9IHRydWU7XHJcbiAgICAgIGpRdWVyeSgnI3VwZGF0ZUVtYWlsJykuaHRtbCgnQ2hhbmdlIEVtYWlsJyk7XHJcbiAgICAgIGpRdWVyeSgnI3VwZGF0ZUVtYWlsJykuYXR0cignZGlzYWJsZWQnLGZhbHNlKTtcclxuICAgICAgdGhpcy5NZXNzYWdlID0gXCJDb20nb24gYXRsZWFzdCBjaGFuZ2Ugc29tZXRoaW5nLlwiO1xyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIGNhbGxHQShvcHQ6IHN0cmluZyl7XHJcbiAgICBzd2l0Y2ggKG9wdCkge1xyXG4gICAgICBjYXNlIFwiVVBEQVRFQUNDT1VOVFwiOlxyXG4gICAgICAgIGdhKCdtYXJrZXR0aW5ndGVhbS5zZW5kJywgJ2V2ZW50JywgJ1NldHRpbmdzJywgJ0NsaWNrJywgJ0VkaXRJbmZvJyk7XHJcbiAgICAgICAgX2ttcS5wdXNoKFsncmVjb3JkJywgJ1NldHRpbmdzIFVwZGF0ZSBhY2NvdW50IGJhc2ljIGluZm8gY2xpY2snXSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8vIFJlc2V0IHRoZSBmb3JtIHdpdGggYSBuZXcgaGVybyBBTkQgcmVzdG9yZSAncHJpc3RpbmUnIGNsYXNzIHN0YXRlXHJcbiAgLy8gYnkgdG9nZ2xpbmcgJ2FjdGl2ZScgZmxhZyB3aGljaCBjYXVzZXMgdGhlIGZvcm1cclxuICAvLyB0byBiZSByZW1vdmVkL3JlLWFkZGVkIGluIGEgdGljayB2aWEgTmdJZlxyXG4gIC8vIFRPRE86IFdvcmthcm91bmQgdW50aWwgTmdGb3JtIGhhcyBhIHJlc2V0IG1ldGhvZCAoIzY4MjIpXHJcblxyXG59XHJcbiJdfQ==
